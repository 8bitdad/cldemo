! This file is managed by Puppet
hostname zebra
log file /var/log/quagga/zebra.log
hostname ospfd
log file /var/log/quagga/ospfd.log
log timestamp precision 6
hostname bgpd
log file /var/log/quagga/bgpd.log
!
password cn321
enable password cn321
!
router-id <%= int_loopback %>
<% if @bgp -%>
router bgp <%= @bgp["my_asn"] %>
  bgp router-id <%= int_loopback %>
  bgp log-neightbour-changes
  network <%= int_loopback %>/32
  <% if @int_bridges -%>
     <% @int_bridges.each do |bridge, options| -%>
  network <% options["address"] %>/<% options["netmask"] %>
    <% end -%>
  <% end -%>
  <% @bgp["peergroupv4"].each do |peer-group| -%>
  neighbour <%= peer-group %> peer-group
  neighbour <%= peer-group %> remote-as <%= @bgp["peergroupv4"][peer-group]["peerasn"] %>
    <% if @bgp["peergroupv4"][peer-group]["route-reflector-client"] -%>
  neighbour <%= peer-group %> route-reflector-client
    <% end -%>
    <% @bgp["peergroupv4"][peer-group]["peers"].each do |peer| -%>
  neighbor {{ peer }} peer-group {{ peer-group }}
    <% end -%>
  <% end -%>
<% end -%>
